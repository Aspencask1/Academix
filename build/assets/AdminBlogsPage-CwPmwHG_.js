import{a as Ee,a7 as C,A as v,a1 as q,a8 as Ie,a9 as Fe,aa as re,j as e,M as De,a2 as B,Y as g,n as ke,T as d,l as u,d as o,G as k,g as z,a3 as ae,S as ze}from"./index-0GGCgQc5.js";import{a as s,T as Re,b as ne,c as qe,G as Me}from"./styles.component-DLLUe8t5.js";import{A as M,u as Qe}from"./get-all-blogs-for-admin.query-BWzkXklW.js";import{u as He,C as le,o as Le}from"./yup-l7oKxK6W.js";import{u as Q}from"./useMutation-DW6lAXSi.js";import{a as Oe,C as Ue,S as Ve,V as oe,b as We}from"./ConfirmDialog-CW7dtUG5.js";import{I as _e}from"./InputAdornment-BltocGSA.js";import{A as ce}from"./Alert-DH6aySMM.js";import{T as Ge,a as Ke,b as Ne,c as R,d as c,e as $e,f as de}from"./TableRow-BfCpx3__.js";import{C as Ye}from"./Chip-BUZF0xjW.js";import{E as ue}from"./Edit-uN2shas0.js";import{D as xe}from"./Delete-CS6izGUm.js";const Je="get-blog-by-id-admin",Xe=i=>Ee({queryKey:[Je,i],queryFn:async()=>i?(await C.getBlogById(i)).data:Promise.reject(new Error("Blog ID is required")),enabled:!!i,staleTime:5*60*1e3,gcTime:10*60*1e3}),Ze=()=>{const{show:i}=v(),l=q();return Q({mutationFn:async({blog:r,imageFile:a})=>(await C.createBlog(r,a)).data,onSuccess:()=>{l.invalidateQueries({queryKey:[M]}),i({title:"Blog created successfully",color:"Success"})},onError:r=>{var a;console.error("Create blog error:",r),i({title:((a=r.response)==null?void 0:a.data.error)||"Failed to create blog",color:"Error"})}})},et=()=>{const i=q(),{show:l}=v();return Q({mutationFn:async r=>r?(await C.deleteBlog(r)).data:void 0,onSuccess:()=>{i.invalidateQueries({queryKey:[M]}),l({title:"Blog deleted successfully",color:"Success"})},onError:r=>{var a;l({title:((a=r.response)==null?void 0:a.data.error)||"Failed to delete blog",color:"Error"})}})},tt=()=>{const{show:i}=v(),l=q();return Q({mutationFn:async({blogId:r,blogPayload:a,imageFile:x})=>(await C.updateBlog({blogId:r,blogPayload:a,imageFile:x})).data,onSuccess:()=>{l.invalidateQueries({queryKey:[M]}),i({title:"Blog updated successfully",color:"Success"})},onError:r=>{var a;i({title:((a=r.response)==null?void 0:a.data.error)||"Failed to update blog",color:"Error"})}})},st=Ie().shape({title:re().trim().min(3,"Title must be at least 3 characters").max(200,"Title cannot exceed 200 characters").required("Blog title is required"),description:re().trim().min(3,"Description must be at least 3 characters").max(5e3,"Description cannot exceed 5000 characters").required("Blog description is required"),image:Fe().test("fileType","Unsupported File Format. Only images are allowed.",i=>!i||typeof i=="string"?!0:i&&i.type.startsWith("image/")).test("fileSize","Image must be less than 10MB.",i=>!i||typeof i=="string"?!0:i&&i.size<=10*1024*1024).optional()}),it=({open:i,onClose:l,blog:r})=>{if(!r)return null;const a={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:{xs:"90%",sm:"70%",md:"50%"},bgcolor:"background.paper",boxShadow:24,p:4,borderRadius:2,maxHeight:"90vh",overflowY:"auto"};return e.jsx(De,{open:i,onClose:l,"aria-labelledby":"blog-detail-title","aria-describedby":"blog-detail-description",children:e.jsxs(B,{sx:a,children:[e.jsx(g,{"aria-label":"close",onClick:l,sx:{position:"absolute",right:8,top:8,color:x=>x.palette.grey[500]},children:e.jsx(ke,{})}),e.jsx(d,{id:"blog-detail-title",variant:"h5",component:"h2",gutterBottom:!0,children:r.title}),e.jsx(u,{sx:{mb:2},children:e.jsx("img",{src:r.image,alt:r.title,style:{maxWidth:"100%",height:"auto",borderRadius:8}})}),e.jsxs(d,{id:"blog-detail-description",sx:{mt:2,mb:2},children:[e.jsx("strong",{children:"Description:"})," ",r.description]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Status:"})," ",r.isActive?"Active":"Inactive"]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Created At:"})," ",new Date(r.createdAt).toLocaleString()]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(r.updatedAt).toLocaleString()]}),r.createdBy&&e.jsxs(d,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Created By:"})," ",r.createdBy.name," (",r.createdBy.email,")"]})]})})},me="https://placehold.co/600x400/CCCCCC/000000?text=No+Image",rt=()=>{var se;const[i,l]=o.useState(null),[r,a]=o.useState(null),[x,H]=o.useState(()=>localStorage.getItem("blogView")||"table"),[ge,L]=o.useState(!1),[he,O]=o.useState(null),[m,S]=o.useState(null),[pe,w]=o.useState(!1),[U,A]=o.useState(null),[P,V]=o.useState(0),[T,je]=o.useState(10),[E,ye]=o.useState(""),[be,fe]=o.useState(""),{data:h,isLoading:W,isError:Be,error:I,refetch:_}=Qe({page:P+1,limit:T,search:be}),{data:y}=Xe(m||""),G=Ze(),K=tt(),b=et(),{show:N}=v(),{handleSubmit:Ce,control:$,reset:f,setValue:p,formState:{errors:j,isSubmitting:ve}}=He({resolver:Le(st),defaultValues:{title:"",description:"",image:void 0}});o.useEffect(()=>{const t=setTimeout(()=>{fe(E)},500);return()=>clearTimeout(t)},[E]),o.useEffect(()=>{var t;if(m&&((t=y==null?void 0:y.data)!=null&&t.blog)){const n=y.data.blog;p("title",n.title),p("description",n.description),a(n.image||null)}else m||(f(),a(null),l(null))},[m,y,p,f]),o.useEffect(()=>{localStorage.setItem("blogView",x)},[x]);const Se=t=>{if(t.target.files&&t.target.files[0]){const n=t.target.files[0];l(n),a(URL.createObjectURL(n)),p("image",n)}else l(null),a(null),p("image",void 0)},we=async t=>{var n,ie;try{if(m)await K.mutateAsync({blogId:m,blogPayload:{title:t.title,description:t.description},imageFile:i||void 0});else{if(!i){N({title:"Please select an image for the blog.",color:"Error"});return}await G.mutateAsync({blog:{title:t.title,description:t.description},imageFile:i})}}catch(D){N({title:((ie=(n=D==null?void 0:D.response)==null?void 0:n.data)==null?void 0:ie.message)||"Operation failed.",color:"Error"})}finally{f(),l(null),a(null),S(null),_()}},Y=t=>{S(t._id),O(t)},J=t=>{A(t),w(!0)},Ae=async()=>{U&&(await b.mutateAsync(U),w(!1),A(null),_())},Pe=()=>{w(!1),A(null)},X=t=>{O(t),L(!0)},Z=(t,n)=>{V(n)},ee=t=>{je(parseInt(t.target.value,10)),V(0)},Te=(t,n)=>{n!==null&&H(n)},F=((se=h==null?void 0:h.data)==null?void 0:se.blogs)||[],te=(h==null?void 0:h.total)||0;return e.jsxs(u,{sx:s.container,children:[e.jsx(d,{variant:"h4",component:"h1",sx:s.header,children:m?"Edit Blog":"Add New Blog"}),e.jsx(B,{elevation:3,sx:s.formContainer,children:e.jsxs("form",{onSubmit:Ce(we),children:[e.jsx(le,{name:"title",control:$,render:({field:t})=>{var n;return e.jsx(k,{...t,label:"Blog Title",variant:"outlined",fullWidth:!0,sx:s.inputField,error:!!j.title,helperText:(n=j.title)==null?void 0:n.message})}}),e.jsx(le,{name:"description",control:$,render:({field:t})=>{var n;return e.jsx(k,{...t,label:"Blog Description",variant:"outlined",fullWidth:!0,multiline:!0,rows:6,sx:s.inputField,error:!!j.description,helperText:(n=j.description)==null?void 0:n.message})}}),e.jsxs(u,{sx:s.imageUploadContainer,children:[e.jsx("input",{accept:"image/*",style:{display:"none"},id:"blog-image-upload",type:"file",onChange:Se}),e.jsx("label",{htmlFor:"blog-image-upload",children:e.jsx(z,{variant:"outlined",component:"span",startIcon:e.jsx(Oe,{}),sx:s.uploadButton,children:"Upload Image"})}),r&&e.jsxs(u,{sx:s.imagePreviewBox,children:[e.jsx("img",{src:r,alt:"Blog Preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}),e.jsx(g,{onClick:()=>{a(null),l(null),p("image",void 0)},sx:s.removeImageButton,children:e.jsx(Ue,{})})]}),j.image&&e.jsx(d,{color:"error",variant:"body2",sx:{mt:1},children:j.image.message})]}),e.jsx(z,{type:"submit",variant:"contained",color:"primary",sx:s.submitButton,disabled:ve||G.isPending||K.isPending,children:m?"Update Blog":"Create Blog"}),m&&e.jsx(z,{variant:"outlined",color:"secondary",onClick:()=>{S(null),f(),a(null),l(null)},sx:s.cancelEditButton,children:"Cancel Edit"})]})}),e.jsxs(u,{sx:{mt:4},children:[e.jsx(d,{variant:"h5",component:"h2",sx:s.subHeader,children:"Existing Blogs"}),e.jsxs(u,{sx:s.searchAndSwitchContainer,children:[e.jsx(k,{label:"Search Blogs",variant:"outlined",size:"small",value:E,onChange:t=>ye(t.target.value),InputProps:{startAdornment:e.jsx(_e,{position:"start",children:e.jsx(Ve,{})})},sx:s.searchField}),e.jsxs(Re,{value:x,exclusive:!0,onChange:Te,"aria-label":"blog view",sx:s.viewToggle,children:[e.jsx(ne,{value:"table","aria-label":"table view",buttonType:"block",sx:{marginRight:.5},children:e.jsx(qe,{})}),e.jsx(ne,{value:"grid","aria-label":"grid view",buttonType:"block",children:e.jsx(Me,{})})]})]}),W?e.jsx(u,{sx:s.loadingBox,children:e.jsx(ae,{})}):Be?e.jsxs(ce,{severity:"error",sx:s.alert,children:["Error loading blogs: ",I==null?void 0:I.message]}):F.length===0?e.jsx(ce,{severity:"info",sx:s.alert,children:"No blogs found."}):e.jsx(e.Fragment,{children:x==="table"?e.jsxs(Ge,{component:B,sx:s.tableContainer,children:[e.jsxs(Ke,{sx:{minWidth:650},children:[e.jsx(Ne,{children:e.jsxs(R,{children:[e.jsx(c,{sx:s.tableHeader,children:"Image"}),e.jsx(c,{sx:s.tableHeader,children:"Title"}),e.jsx(c,{sx:s.tableHeader,children:"Description"}),e.jsx(c,{sx:s.tableHeader,children:"Created By"}),e.jsx(c,{sx:s.tableHeader,children:"Status"}),e.jsx(c,{sx:s.tableHeader,align:"right",children:"Actions"})]})}),e.jsx($e,{children:W?e.jsx(R,{children:e.jsx(c,{colSpan:6,sx:s.tableCell,children:e.jsx(ae,{})})}):F.map(t=>e.jsxs(R,{sx:s.tableRow,children:[e.jsx(c,{children:e.jsx("img",{src:t.image||me,alt:t.title,style:{width:"50px",height:"50px",objectFit:"cover",borderRadius:"4px",flexShrink:0}})}),e.jsx(c,{sx:s.tableCell,children:t.title}),e.jsx(c,{sx:s.tableCell,children:t.description.length>50?`${t.description.substring(0,50)}...`:t.description}),e.jsx(c,{sx:s.tableCell,children:t.createdBy&&typeof t.createdBy=="object"?t.createdBy.name:"N/A"}),e.jsx(c,{sx:s.tableCell,children:e.jsx(Ye,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"error",variant:"filled",size:"small",sx:{fontSize:"0.8rem"}})}),e.jsx(c,{align:"right",sx:s.tableCell,children:e.jsxs(u,{sx:s.tableActions,children:[e.jsx(g,{size:"small",onClick:()=>Y(t),"aria-label":"edit blog",disabled:!t.isActive,sx:{cursor:t.isActive?"pointer":"not-allowed !important"},children:e.jsx(ue,{fontSize:"small"})}),e.jsx(g,{size:"small",onClick:()=>X(t),"aria-label":"view blog",children:e.jsx(oe,{fontSize:"small"})}),e.jsx(g,{size:"small",onClick:()=>J(t._id),"aria-label":"delete blog",disabled:!t.isActive||b.isPending,sx:{cursor:t.isActive?"pointer":"not-allowed !important"},children:e.jsx(xe,{fontSize:"small"})})]})})]},t._id))})]}),e.jsx(de,{rowsPerPageOptions:[5,10,25],component:"div",count:te,rowsPerPage:T,page:P,onPageChange:Z,onRowsPerPageChange:ee,sx:s.paginationWrapper})]}):e.jsxs(ze,{children:[e.jsx(u,{sx:s.blogGrid,children:F.map(t=>e.jsxs(B,{elevation:2,sx:s.blogCard,children:[e.jsx("img",{src:t.image||me,alt:t.title,style:{width:"100%",height:"180px",objectFit:"cover"}}),e.jsxs(u,{sx:s.blogCardContent,children:[e.jsx(d,{variant:"h6",sx:s.blogCardTitle,children:t.title}),e.jsx(d,{variant:"body2",sx:s.blogCardDescription,children:t.description}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Created By:"," ",t.createdBy&&typeof t.createdBy=="object"?t.createdBy.name:"N/A"]}),e.jsxs(d,{variant:"body2",color:"text.secondary",children:["Status: ",t.isActive?"Active":"Inactive"]}),e.jsxs(u,{sx:s.blogCardActions,children:[e.jsx(g,{color:"primary",size:"small",onClick:()=>Y(t),disabled:!t.isActive,title:t.isActive?"Edit blog":"Cannot edit inactive blog",children:e.jsx(ue,{fontSize:"small"})}),e.jsx(g,{color:"error",size:"small",onClick:()=>J(t._id),disabled:!t.isActive||b.isPending,sx:{cursor:t.isActive?"pointer":"not-allowed !important"},children:e.jsx(xe,{fontSize:"small"})}),e.jsx(g,{color:"success",size:"small",onClick:()=>X(t),children:e.jsx(oe,{fontSize:"small"})})]})]})]},t._id))}),e.jsx(de,{rowsPerPageOptions:[5,10,25],component:"div",count:te,rowsPerPage:T,page:P,onPageChange:Z,onRowsPerPageChange:ee,sx:s.paginationWrapper})]})})]}),e.jsx(it,{open:ge,onClose:()=>L(!1),blog:he}),e.jsx(We,{open:pe,onClose:Pe,onConfirm:Ae,title:"Confirm Deletion",description:"Are you sure you want to delete this blog? This action cannot be undone.",loading:b.isPending})]})},jt=()=>e.jsx(rt,{});export{jt as default};

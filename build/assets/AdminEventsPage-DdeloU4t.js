import{a as Ke,a0 as T,A as k,a1 as q,j as e,M as $e,a2 as I,Y as f,n as Ne,l,a3 as Q,T as u,d as i,g as pe,S as he,G as w,a4 as Ye}from"./index-0GGCgQc5.js";import{u as Je,C as Xe,o as Ze}from"./yup-l7oKxK6W.js";import{A as H,u as et}from"./get-all-events-for-admin.query-OFCvPb7E.js";import{u as K}from"./useMutation-DW6lAXSi.js";import{T as tt,a as st,b as ge,c as rt,G as nt}from"./styles.component-DLLUe8t5.js";import{C as fe,a as it,S as ot,V as be,b as at}from"./ConfirmDialog-CW7dtUG5.js";import{C as O}from"./Chip-BUZF0xjW.js";import{I as lt}from"./InputAdornment-BltocGSA.js";import{A as ye}from"./Alert-DH6aySMM.js";import{T as ct,a as dt,b as ut,c as je,d,e as xt,f as ve}from"./TableRow-BfCpx3__.js";import{E as Ee}from"./Edit-uN2shas0.js";import{D as Ce}from"./Delete-CS6izGUm.js";const mt="get-event-by-id-admin",Ae=c=>Ke({queryKey:[mt,c],queryFn:async()=>c?(await T.getEventById(c)).data:Promise.reject(new Error("Event ID is required")),enabled:!!c,staleTime:0,gcTime:5*60*1e3}),pt=()=>{const{show:c}=k(),a=q();return K({mutationFn:async({data:o,imageFile:n})=>(await T.createEvent(o,n)).data,onSuccess:()=>{c({title:"Event created successfully",color:"Success"}),a.invalidateQueries({queryKey:[H]})},onError:o=>{var n;c({title:(n=o.response)==null?void 0:n.data.error,color:"Error"})}})},ht=()=>{const c=q(),{show:a}=k();return K({mutationFn:async({eventId:o,data:n,imageFile:b})=>(await T.updateEvent(o,n,b)).data,onSuccess:()=>{c.invalidateQueries({queryKey:[H]}),a({title:"Event updated successfully",color:"Success"})},onError:o=>{var n;a({title:((n=o.response)==null?void 0:n.data.message)||o.message||"Failed to update event",color:"Error"})}})},gt=()=>{const c=q(),{show:a}=k();return K({mutationFn:async o=>(await T.deleteEvent(o)).data,onSuccess:()=>{c.invalidateQueries({queryKey:[H]}),a({title:"Event deleted successfully",color:"Success"})},onError:o=>{var n;a({title:((n=o.response)==null?void 0:n.data.message)||o.message||"Failed to delete event",color:"Error"})}})},m={container:{padding:"2rem",borderRadius:"12px",boxShadow:"0 8px 24px rgba(0, 0, 0, 0.15)",maxWidth:"1200px",margin:"2rem auto",backgroundColor:"#ffffff",transition:"background-color 0.3s ease-in-out"},header:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},title:{fontSize:"2.5rem",marginBottom:"1.5rem",color:"#1e293b",textAlign:"center",fontWeight:"700",textShadow:"1px 1px 2px rgba(0,0,0,0.05)"},formContainer:{padding:"2rem",marginBottom:"2rem"},submitButton:{backgroundColor:"#16a34a",color:"#ffffff",padding:"1.2rem 2rem",borderRadius:"8px",border:"none",fontSize:"1.2rem",fontWeight:"bold",cursor:"pointer",marginTop:"2rem",transition:"background-color 0.2s ease-in-out, transform 0.2s ease-in-out"},subHeader:{fontSize:"1.8rem",fontWeight:"600",color:"#1e293b",marginBottom:"1.5rem"},searchAndSwitchContainer:{display:"flex",gap:"1rem",marginBottom:"2rem",alignItems:"center",justifyContent:"flex-end"},searchField:{flexGrow:1,maxWidth:"400px"},eventGrid:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"2rem",marginBottom:"2rem"},eventCard:{borderRadius:"12px",overflow:"hidden",transition:"transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out"},paginationContainer:{display:"flex",justifyContent:"center",marginTop:"2rem"}},we="https://placehold.co/600x400/F0F0F0/333333?text=Event+Image",ft=({open:c,onClose:a,eventId:o})=>{var S;const{data:n,isLoading:b,isError:h}=Ae(o||void 0),r=(S=n==null?void 0:n.data)==null?void 0:S.event;return e.jsx($e,{open:c,onClose:a,"aria-labelledby":"event-detail-title","aria-describedby":"event-detail-description",sx:{display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsxs(I,{sx:{position:"relative",width:{xs:"90%",sm:500},maxWidth:600,p:4,borderRadius:2,boxShadow:24,outline:"none"},children:[e.jsx(f,{"aria-label":"close",onClick:a,sx:{position:"absolute",right:8,top:8,color:y=>y.palette.grey[500]},children:e.jsx(Ne,{})}),b?e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Q,{})}):h||!r?e.jsx(u,{color:"error",sx:{py:4,textAlign:"center"},children:"Failed to load event details."}):e.jsxs(e.Fragment,{children:[e.jsx(l,{sx:{mb:2,textAlign:"center"},children:e.jsx("img",{src:r.image||we,alt:r.title,style:{maxWidth:"100%",maxHeight:220,borderRadius:8},onError:y=>y.currentTarget.src=we})}),e.jsx(u,{id:"event-detail-title",variant:"h5",component:"h2",gutterBottom:!0,children:r.title}),e.jsxs(u,{id:"event-detail-description",sx:{mt:2,mb:2,maxHeight:"100px",overflowY:"scroll","&::-webkit-scrollbar":{width:"8px",backgroundColor:"#f1f1f1"},"&::-webkit-scrollbar-thumb":{backgroundColor:"#bdbdbd",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"#888"}},children:[e.jsx("strong",{children:"Description:"})," ",r.description]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Price:"})," ",r.price===0?"Free":`â‚¹${r.price}`]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Status:"})," ",r.isActive?"Active":"Inactive"]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Created At:"})," ",new Date(r.createdAt).toLocaleString()]}),e.jsxs(u,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Last Updated:"})," ",new Date(r.updatedAt).toLocaleString()]}),r.paymentUrl&&e.jsx(l,{sx:{mt:2},children:e.jsx(O,{label:"Go to Payment Page",color:"primary",component:"a",href:r.paymentUrl,target:"_blank",clickable:!0})})]})]})})},Se="https://placehold.co/400x300/F0F0F0/333333?text=Edunova+Event",bt=()=>{var ce,de,ue,xe,me;const c=Je({resolver:Ze(Ye),defaultValues:{title:"",description:"",price:0,paymentUrl:"",image:""},mode:"onTouched"}),{register:a,handleSubmit:o,reset:n,control:b,setValue:h,formState:{errors:r,isValid:S}}=c,[y,$]=i.useState(!1),[F,E]=i.useState(null),[A,Pe]=i.useState(()=>localStorage.getItem("eventView")||"grid"),[D,N]=i.useState(0),[R,Ie]=i.useState(10),[z,Te]=i.useState(""),[ke,Fe]=i.useState(""),[C,Y]=i.useState(null),[De,B]=i.useState(!1),[J,W]=i.useState(null),[x,X]=i.useState(!1),{mutateAsync:Re,isPending:Z}=pt(),{mutateAsync:ze,isPending:ee}=ht(),{mutateAsync:Be,isPending:P}=gt(),{show:U}=k(),{data:j,isLoading:We,isError:Ue,error:L,refetch:Le}=et({page:D+1,limit:R,search:ke}),{data:v}=Ae(C||void 0);i.useEffect(()=>{const t=setTimeout(()=>{Fe(z)},500);return()=>clearTimeout(t)},[z]),i.useEffect(()=>{localStorage.setItem("eventView",A)},[A]);const G=i.useRef(null);i.useEffect(()=>{var t;if((t=v==null?void 0:v.data)!=null&&t.event&&C){const s=v.data.event;h("title",s.title),h("description",s.description),h("price",s.price),h("paymentUrl",s.paymentUrl),h("image",s.image),X(!0)}},[v,C,h]),i.useEffect(()=>{x&&G.current&&G.current.scrollIntoView({behavior:"smooth"})},[x,v]);const Ge=async t=>{var s,p;try{if(!F&&!x){U({title:"Please select an image for the event.",color:"Error"});return}x&&C?(await ze({eventId:C,data:t,imageFile:F||void 0}),se()):(await Re({data:t,imageFile:F}),E(null),n()),Le()}catch(g){U({title:((p=(s=g==null?void 0:g.response)==null?void 0:s.data)==null?void 0:p.message)||"Failed to save event.",color:"Error"})}},te=t=>{Y(t)},se=()=>{Y(null),X(!1),E(null),n()},re=t=>{W(t),B(!0)},_e=async()=>{if(J)try{await Be(J),B(!1),W(null)}catch{}},ne=(t,s)=>{if(t&&t.type.startsWith("image/")){E(t);const p=URL.createObjectURL(t);s(p)}else U({title:"Please select a valid image file (PNG, JPG, GIF)",color:"Error"}),E(null),s("")},Ve=(t,s)=>{var g;const p=(g=t.target.files)==null?void 0:g[0];p&&ne(p,s)},_=t=>{t.preventDefault(),t.stopPropagation(),$(t.type==="dragenter"||t.type==="dragover")},Me=(t,s)=>{var g;t.preventDefault(),t.stopPropagation(),$(!1);const p=(g=t.dataTransfer.files)==null?void 0:g[0];p&&ne(p,s)},Qe=t=>{t(""),E(null)},ie=(t,s)=>{N(s)},oe=t=>{Ie(parseInt(t.target.value,10)),N(0)},Oe=(t,s)=>{s!==null&&Pe(s)},V=((ce=j==null?void 0:j.data)==null?void 0:ce.events)||[],ae=(j==null?void 0:j.total)||0,[qe,M]=i.useState(!1),[He,le]=i.useState(null);return e.jsxs("div",{ref:G,style:m.container,children:[e.jsxs(l,{sx:m.header,children:[e.jsx(u,{variant:"h4",component:"h1",sx:m.title,children:x?"Edit Event":"Add New Event"}),x&&e.jsx(pe,{variant:"outlined",onClick:se,startIcon:e.jsx(fe,{}),children:"Cancel Edit"})]}),e.jsx(I,{elevation:2,sx:m.formContainer,children:e.jsx("form",{onSubmit:o(Ge),children:e.jsxs(he,{spacing:3,children:[e.jsx(w,{...a("title"),label:"Event Title",fullWidth:!0,error:!!r.title,helperText:(de=r.title)==null?void 0:de.message}),e.jsx(w,{...a("description"),label:"Event Description",fullWidth:!0,multiline:!0,rows:4,error:!!r.description,helperText:(ue=r.description)==null?void 0:ue.message}),e.jsx(w,{...a("price"),label:"Event Price",type:"number",fullWidth:!0,error:!!r.price,helperText:(xe=r.price)==null?void 0:xe.message}),e.jsx(w,{...a("paymentUrl"),label:"Payment URL",fullWidth:!0,error:!!r.paymentUrl,helperText:(me=r.paymentUrl)==null?void 0:me.message}),e.jsx(Xe,{name:"image",control:b,render:({field:t})=>e.jsxs(l,{children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:"Event Image"}),e.jsxs(l,{sx:{border:"2px dashed",borderColor:y?"primary.main":"grey.300",borderRadius:2,p:3,textAlign:"center",cursor:"pointer",backgroundColor:y?"action.hover":"background.paper"},onDragEnter:_,onDragLeave:_,onDragOver:_,onDrop:s=>Me(s,t.onChange),onClick:()=>{var s;return(s=document.getElementById("image-upload"))==null?void 0:s.click()},children:[e.jsx("input",{id:"image-upload",type:"file",accept:"image/*",style:{display:"none"},onChange:s=>Ve(s,t.onChange)}),e.jsx(it,{sx:{fontSize:48,color:"grey.500",mb:2}}),e.jsx(u,{variant:"body2",color:"textSecondary",children:t.value?"Image selected":"Drag and drop an image or click to select"}),t.value&&e.jsxs(l,{sx:{mt:2,position:"relative",display:"inline-block"},children:[e.jsx("img",{src:t.value,alt:"Preview",style:{maxWidth:"200px",maxHeight:"150px",objectFit:"cover",borderRadius:"8px"}}),e.jsx(f,{size:"small",onClick:()=>Qe(t.onChange),sx:{position:"absolute",top:4,right:4,background:"rgba(255,255,255,0.8)",zIndex:2},children:e.jsx(fe,{fontSize:"small"})})]})]})]})}),e.jsx(pe,{type:"submit",variant:"contained",size:"large",disabled:!S||Z||ee,sx:m.submitButton,children:Z||ee?e.jsx(Q,{size:24}):x?"Update Event":"Create Event"})]})})}),e.jsxs(l,{sx:{mt:4},children:[e.jsx(u,{variant:"h5",component:"h2",sx:m.subHeader,children:"Existing Events"}),e.jsxs(l,{sx:m.searchAndSwitchContainer,children:[e.jsx(w,{label:"Search Events",variant:"outlined",size:"small",value:z,onChange:t=>Te(t.target.value),InputProps:{startAdornment:e.jsx(lt,{position:"start",children:e.jsx(ot,{})})},sx:m.searchField}),e.jsxs(tt,{value:A,exclusive:!0,onChange:Oe,"aria-label":"event view",sx:st.viewToggle,children:[e.jsx(ge,{value:"table","aria-label":"table view",buttonType:"block",sx:{marginRight:.5},children:e.jsx(rt,{})}),e.jsx(ge,{value:"grid","aria-label":"grid view",buttonType:"block",children:e.jsx(nt,{})})]})]}),We?e.jsx(l,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(Q,{})}):Ue?e.jsxs(ye,{severity:"error",sx:{mb:2},children:["Error loading events: ",L==null?void 0:L.message]}):V.length===0?e.jsx(ye,{severity:"info",sx:{mb:2},children:"No events found."}):e.jsx(e.Fragment,{children:A==="table"?e.jsxs(ct,{component:I,sx:{mb:2},children:[e.jsxs(dt,{sx:{minWidth:650},children:[e.jsx(ut,{children:e.jsxs(je,{children:[e.jsx(d,{sx:{fontWeight:"bold"},children:"Image"}),e.jsx(d,{sx:{fontWeight:"bold"},children:"Title"}),e.jsx(d,{sx:{fontWeight:"bold"},children:"Description"}),e.jsx(d,{sx:{fontWeight:"bold"},children:"Price"}),e.jsx(d,{sx:{fontWeight:"bold"},children:"Payment URL"}),e.jsx(d,{sx:{fontWeight:"bold"},children:"Status"}),e.jsx(d,{sx:{fontWeight:"bold"},align:"right",children:"Actions"})]})}),e.jsx(xt,{children:V.map(t=>e.jsxs(je,{children:[e.jsx(d,{children:e.jsx("img",{src:t.image||Se,alt:t.title,style:{width:"60px",height:"40px",objectFit:"cover",borderRadius:"4px"}})}),e.jsx(d,{children:t.title}),e.jsx(d,{children:t.description.length>50?`${t.description.substring(0,50)}...`:t.description}),e.jsx(d,{children:t.price===0?"Free":`â‚¹${t.price}`}),e.jsx(d,{children:e.jsx("a",{href:t.paymentUrl,target:"_blank",rel:"noopener noreferrer",style:{color:"inherit"},children:t.paymentUrl.length>30?`${t.paymentUrl.substring(0,30)}...`:t.paymentUrl})}),e.jsx(d,{children:e.jsx(O,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"error",variant:"filled",size:"small"})}),e.jsx(d,{align:"right",children:e.jsxs(l,{sx:{display:"flex",gap:1,justifyContent:"flex-end"},children:[e.jsx(f,{color:"primary",size:"small",onClick:()=>te(t._id),disabled:!t.isActive||x,children:e.jsx(Ee,{fontSize:"small"})}),e.jsx(f,{color:"error",size:"small",onClick:()=>re(t._id),loading:P,disabled:!t.isActive||P||x,children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(f,{color:"success",size:"small",onClick:()=>{le(t._id),M(!0)},children:e.jsx(be,{fontSize:"small"})})]})})]},t._id))})]}),e.jsx(ve,{rowsPerPageOptions:[5,10,25],component:"div",count:ae,rowsPerPage:R,page:D,onPageChange:ie,onRowsPerPageChange:oe})]}):e.jsxs(he,{children:[e.jsx(l,{sx:m.eventGrid,children:V.map(t=>e.jsxs(I,{elevation:2,sx:{...m.eventCard,display:"flex",flexDirection:"column",height:"100%"},children:[e.jsx("img",{src:t.image||Se,alt:t.title,style:{width:"100%",height:"180px",objectFit:"cover"}}),e.jsxs(l,{sx:{p:2,flexGrow:1,display:"flex",flexDirection:"column"},children:[e.jsx(u,{variant:"h6",gutterBottom:!0,children:t.title}),e.jsx(u,{variant:"body2",color:"textSecondary",sx:{mb:2,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:t.description}),e.jsxs(u,{variant:"body2",color:"primary",sx:{fontWeight:"bold",mb:2},children:["Price:"," ",t.price===0?"Free":`â‚¹${t.price}`]}),e.jsx(l,{sx:{flexGrow:1}}),e.jsxs(l,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",marginTop:"auto"},children:[e.jsx(O,{label:t.isActive?"Active":"Inactive",color:t.isActive?"success":"error",variant:"filled",size:"small"}),e.jsxs(l,{sx:{display:"flex",gap:1},children:[e.jsx(f,{color:"primary",size:"small",onClick:()=>te(t._id),disabled:!t.isActive||x,children:e.jsx(Ee,{fontSize:"small"})}),e.jsx(f,{color:"error",size:"small",onClick:()=>re(t._id),disabled:!t.isActive||P||x,children:e.jsx(Ce,{fontSize:"small"})}),e.jsx(f,{color:"success",size:"small",onClick:()=>{le(t._id),M(!0)},children:e.jsx(be,{fontSize:"small"})})]})]})]})]},t._id))}),e.jsx(ve,{rowsPerPageOptions:[5,10,25],component:"div",count:ae,rowsPerPage:R,page:D,onPageChange:ie,onRowsPerPageChange:oe,sx:m.paginationContainer})]})})]}),e.jsx(at,{open:De,title:"Delete Event",description:"Are you sure you want to delete this event? This action cannot be undone.",onConfirm:_e,loading:P,onClose:()=>{B(!1),W(null)}}),e.jsx(ft,{open:qe,onClose:()=>M(!1),eventId:He})]})},Ft=()=>e.jsx(bt,{});export{Ft as default};

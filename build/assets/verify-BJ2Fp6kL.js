import{A as v,X as y,d as m,aG as C,j as t,T as o,g as P,aH as I,aI as M,k as $}from"./index-0GGCgQc5.js";import{u as k,a as O}from"./app.route.state-BHKaGZie.js";import{F as W,n as B,o as D}from"./styled.component-BrJt8NDi.js";import"./styles.component-B_MFmkMU.js";import"./styles.component-BIt1iqvu.js";import{u as H,C as q,o as G}from"./yup-l7oKxK6W.js";import{u as x}from"./useMutation-DW6lAXSi.js";const L=()=>{const{show:e}=v();return x({mutationFn:async i=>(await y.resendOtp(i)).data,onSuccess:()=>{e({title:"OTP resent successfully",color:"Success"})}})},X=()=>{const{show:e}=v(),{appNavigate:i}=k();return x({mutationFn:async s=>(await y.verifyEmail(s)).data,onSuccess:()=>{e({title:"Sign up successfully",color:"Success"}),i("/")}})};function _({signUpPayload:e}){const{email:i}=e,[s,l]=m.useState(30),[d,p]=m.useState(!0);m.useEffect(()=>{let r;return d&&s>0?r=setInterval(()=>{l(a=>a-1)},1e3):s===0&&p(!1),()=>clearInterval(r)},[d,s]);const g=()=>{l(30),p(!0)},{control:j,handleSubmit:S,reset:b,formState:{isValid:E}}=H({defaultValues:{otp:"",email:e.email},resolver:G(I)}),f=C.useRef(null),{mutateAsync:N,isPending:u}=X(),{mutateAsync:R,isPending:h}=L(),w=r=>{N(r)},A=()=>{s||(R({email:e.email}),b(),g())},F=r=>r!==""&&!Number.isNaN(Number(r)),T=i.replace(/^(.*)(..)(@.*)$/,(r,...a)=>{const[c,n,V]=a;return"*".repeat(c.length)+n+V});return t.jsxs(W,{component:"form",ref:f,onSubmit:r=>void S(w)(r),children:[t.jsxs(B,{children:[t.jsx(o,{variant:"h5.600",children:"Verify Email"}),t.jsx(o,{variant:"body1.400",color:"text.secondary",children:` We have sent a verification code to ${T}. Please enter the code
          below.`})]}),t.jsx(q,{name:"otp",control:j,render:({field:r,fieldState:a})=>{var c;return t.jsxs("div",{children:[t.jsx(o,{variant:"caption1.400",color:"text.secondary",children:"Enter the code sent to your email"}),t.jsx(D,{error:!!a.error,TextFieldsProps:{disabled:u,error:!!a.error},autoFocus:!0,value:r.value,onComplete:()=>{var n;(n=f.current)==null||n.requestSubmit()},validateChar:F,onChange:n=>r.onChange({target:{value:n}}),length:6}),t.jsx(o,{variant:"caption1.400",color:"error",children:(c=a.error)==null?void 0:c.message})]})}}),t.jsx(P,{loading:u||h,disabled:!E||u||h,type:"submit",children:"Verify Email"}),t.jsxs(o,{color:"text.secondary",align:"center",variant:"body1",children:["Did not receive code?"," ",t.jsx(o,{display:"inline",sx:{textDecoration:s?"none":"underline",fontWeight:500,cursor:s?"default":"pointer"},onClick:A,children:s?`Resend code in ${s} seconds`:"Resend code"})]})]})}function ee(){const{state:e}=O();return!e.email||!e.password||!e.name?t.jsx(M,{to:$.userLogin}):t.jsx(_,{signUpPayload:{email:e.email,password:e.password,name:`${e.firstName} ${e.lastName}`}})}export{ee as VerifyEmailPage};
